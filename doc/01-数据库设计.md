# OKTalk AI 发音纠正系统 - 数据库设计文档（最终版）

## 文档信息
- **版本**: v2.0（最终确定版）
- **创建日期**: 2026-02-15
- **数据库**: MySQL 8.0+
- **字符集**: utf8mb4_unicode_ci
- **支持功能**: 
  - AI 语音对话（question_answer / free_talk）
  - AI 发音纠正（分级反馈机制）
  - 智能学习报告生成（雷达图分析）

---

## 第一部分：表清单

| 序号 | 表名 | 用途说明 | 数据量估计 |
|------|------|---------|---------|
| 1 | `users` | 用户基础信息表 | 1K - 10K |
| 2 | `user_profiles` | 用户扩展信息表 | 1K - 10K |
| 3 | `voice_conversations` | 语音对话记录表 | 10K - 100K |
| 4 | `conversation_messages` | 对话消息明细表 | 100K - 1M |
| 5 | `pronunciation_evaluations` | 发音评测记录表 | 10K - 100K |
| 6 | `learning_reports` | 学习报告表 | 1K - 10K |
| 7 | `system_settings` | 系统配置表 | < 100 |

**总计**: 7 张表

---

## 第二部分：表结构详细设计

### 表 1：users（用户基础信息表）

**用途**: 存储用户的基础账户信息

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 用户 ID (UUID) |
| username | VARCHAR | 100 | ✓ | ✓ | - | 用户名 |
| password_hash | VARCHAR | 255 | ✓ | ✗ | - | 密码哈希值 |
| phone | VARCHAR | 20 | ✗ | ✓ | NULL | 手机号 |
| avatar_url | VARCHAR | 500 | ✗ | ✗ | NULL | 头像 URL |
| grade | INT | - | ✗ | ✗ | NULL | 年级 (1-6 代表小学 1-6 年级) |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | TIMESTAMP | - | ✗ | ✗ | NULL | 软删除时间 |

**索引**:
- PRIMARY KEY: `id`
- UNIQUE KEY: `username`, `phone`
- INDEX: `created_at`, `deleted_at`

**说明**:
- `grade` 字段用于区分用户年级，影响对话难度和反馈风格
- 支持软删除（`deleted_at`）

---

### 表 2：user_profiles（用户扩展信息表）

**用途**: 存储用户的详细个人信息和学习统计数据

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 主键 ID (UUID) |
| user_id | VARCHAR | 36 | ✓ | ✓ | - | 用户 ID (FK → users.id) |
| age | INT | - | ✗ | ✗ | NULL | 年龄 |
| gender | ENUM | - | ✗ | ✗ | NULL | 性别：male / female  |
| bio | TEXT | - | ✗ | ✗ | NULL | 个人简介 |
| total_conversations | INT | - | ✓ | ✗ | 0 | 总对话数 |
| total_evaluations | INT | - | ✓ | ✗ | 0 | 总评测数 |
| total_reports | INT | - | ✓ | ✗ | 0 | 总报告数 |
| total_study_minutes | INT | - | ✓ | ✗ | 0 | 累计学习时长（分钟） |
| average_evaluation_score | FLOAT | - | ✓ | ✗ | 0.0 | 平均评测分数 |
| last_conversation_at | TIMESTAMP | - | ✗ | ✗ | NULL | 上次对话时间 |
| last_evaluation_at | TIMESTAMP | - | ✗ | ✗ | NULL | 上次评测时间 |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- FOREIGN KEY: `user_id` → `users(id)` ON DELETE CASCADE
- UNIQUE KEY: `user_id`
- INDEX: `last_conversation_at`, `last_evaluation_at`

**说明**:
- 统计字段用于加速查询，避免频繁聚合计算
- `total_study_minutes` 用于学习报告生成

---

### 表 3：voice_conversations（语音对话记录表）

**用途**: 存储用户的 AI 语音对话会话

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 对话 ID (UUID) |
| user_id | VARCHAR | 36 | ✓ | ✗ | - | 用户 ID (FK → users.id) |
| topic | VARCHAR | 200 | ✓ | ✗ | - | 对话主题（如 "Greetings", "Daily Routine"） |
| difficulty_level | ENUM | - | ✓ | ✗ | 'beginner' | 难度等级：beginner / intermediate / advanced |
| conversation_type | ENUM | - | ✓ | ✗ | 'free_talk' | 对话类型：free_talk / question_answer |
| message_count | INT | - | ✓ | ✗ | 0 | 消息总数（包括用户和 AI） |
| duration_seconds | INT | - | ✓ | ✗ | 0 | 对话时长（秒） |
| status | ENUM | - | ✓ | ✗ | 'active' | 对话状态：active / completed / paused |
| summary | TEXT | - | ✗ | ✗ | NULL | 对话摘要（可由 AI 异步生成） |
| score | INT | - | ✗ | ✗ | NULL | 对话评分（0-100，可选） |
| feedback | TEXT | - | ✗ | ✗ | NULL | AI 反馈内容（可选） |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |
| deleted_at | TIMESTAMP | - | ✗ | ✗ | NULL | 软删除时间 |

**索引**:
- PRIMARY KEY: `id`
- FOREIGN KEY: `user_id` → `users(id)` ON DELETE CASCADE
- INDEX: `user_id`, `created_at`
- INDEX: `conversation_type`, `status`
- INDEX: `deleted_at`

**说明**:
- `conversation_type` 支持两种类型：
  - `free_talk`: 自由对话
  - `question_answer`: 问答模式
- `duration_seconds` 用于统计学习时长

---

### 表 4：conversation_messages（对话消息明细表）

**用途**: 存储对话中的每一条消息（用户或 AI），每条消息单独一条记录

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 消息 ID (UUID) |
| conversation_id | VARCHAR | 36 | ✓ | ✗ | - | 对话 ID (FK → voice_conversations.id) |
| sender_type | ENUM | - | ✓ | ✗ | - | 发送者类型：user / ai |
| message_text | LONGTEXT | - | ✓ | ✗ | - | 消息文本内容 |
| audio_url | VARCHAR | 500 | ✗ | ✗ | NULL | 音频 URL（用户语音或 AI 语音） |
| audio_duration | INT | - | ✗ | ✗ | NULL | 音频时长（秒） |
| sequence_number | INT | - | ✓ | ✗ | - | 消息序号（对话内的顺序，从 1 开始） |
| latency_ms | INT | - | ✗ | ✗ | NULL | 处理延迟（毫秒，用于性能分析） |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- FOREIGN KEY: `conversation_id` → `voice_conversations(id)` ON DELETE CASCADE
- INDEX: `conversation_id`, `sequence_number`
- INDEX: `sender_type`, `created_at`

**说明**:
- **重要变更**: 用户消息和 AI 消息分开存储，每条消息单独一条记录
- `sequence_number` 确保消息顺序
- 示例存储：
  ```
  对话 conv_001:
  ├─ msg_001 (user):  "Hello"          (sequence: 1)
  ├─ msg_002 (ai):    "Hi! How are?"   (sequence: 2)
  ├─ msg_003 (user):  "I'm fine"       (sequence: 3)
  └─ msg_004 (ai):    "Great!"         (sequence: 4)
  ```

---

### 表 5：pronunciation_evaluations（发音评测记录表）

**用途**: 存储用户的发音评测结果和分级反馈数据

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 评测 ID (UUID) |
| user_id | VARCHAR | 36 | ✓ | ✗ | - | 用户 ID (FK → users.id) |
| target_text | VARCHAR | 500 | ✓ | ✗ | - | 目标朗读文本 |
| recognized_text | VARCHAR | 500 | ✗ | ✗ | NULL | 识别出的文本 |
| audio_url | VARCHAR | 500 | ✗ | ✗ | NULL | 原始录音 URL |
| audio_duration | INT | - | ✗ | ✗ | NULL | 录音时长（秒） |
| overall_score | INT | - | ✓ | ✗ | 0 | **综合评分**（0-100） |
| accuracy_score | INT | - | ✓ | ✗ | 0 | **准确度评分**（0-100） |
| fluency_score | INT | - | ✓ | ✗ | 0 | **流利度评分**（0-100） |
| integrity_score | INT | - | ✓ | ✗ | 0 | **完整度评分**（0-100） |
| feedback_level | ENUM | - | ✓ | ✗ | 'C' | **反馈级别**：S / A / B / C |
| feedback_text | TEXT | - | ✗ | ✗ | NULL | **反馈文本内容** |
| feedback_audio_url | VARCHAR | 500 | ✗ | ✗ | NULL | **反馈音频 URL** |
| problem_words | JSON | - | ✗ | ✗ | NULL | **问题单词列表** (JSON 数组: ["apple", "oranges"]) |
| problem_word_audio_urls | JSON | - | ✗ | ✗ | NULL | **问题单词示范音频 URL** (JSON 对象: {"apple": "url1", "oranges": "url2"}) |
| demo_sentence_audio_url | VARCHAR | 500 | ✗ | ✗ | NULL | **整句示范音频 URL**（仅 C 级需要） |
| difficulty_level | ENUM | - | ✓ | ✗ | 'beginner' | 难度级别：beginner / intermediate / advanced |
| assessment_sid | VARCHAR | 100 | ✗ | ✗ | NULL | 语音评测会话 ID（例如讯飞返回的 SID） |
| speech_assessment_json | LONGTEXT | - | ✗ | ✗ | NULL | 语音评测服务返回的原始评测数据（JSON） |
| status | ENUM | - | ✓ | ✗ | 'pending' | 状态：pending / processing / completed / failed |
| error_message | VARCHAR | 500 | ✗ | ✗ | NULL | 错误信息（失败时） |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- FOREIGN KEY: `user_id` → `users(id)` ON DELETE CASCADE
- INDEX: `user_id`, `created_at`
- INDEX: `feedback_level`, `overall_score`
- INDEX: `status`, `created_at`

**分级反馈机制说明**:

| 级别 | 分数范围 | 反馈策略 | 示范音频 | 示例反馈文本 |
|------|---------|---------|---------|------------|
| **S 级** | 90-100 | 纯鼓励 | ❌ 不需要 | "Perfect! Your pronunciation is excellent!" |
| **A 级** | 70-89 | 鼓励 + 诊断 | ✅ 问题单词 | "Very good! But 'apples' can be even better." |
| **B 级** | 50-69 | 诊断 + 示范 | ✅ 问题单词 | "Good try! Let's practice 'apples' together. Listen to how I say it." |
| **C 级** | 0-49 | 完整示范 | ✅ 整句 | "Keep going! Let me read it for you first: I like apples. Now you try!" |

**字段使用规则**:
- **S 级**:
  - `feedback_text`: 纯鼓励文本
  - `problem_words`: NULL
  - `problem_word_audio_urls`: NULL
  - `demo_sentence_audio_url`: NULL

- **A 级**:
  - `feedback_text`: 鼓励 + 诊断
  - `problem_words`: ["apple", "oranges"]
  - `problem_word_audio_urls`: {"apple": "url1", "oranges": "url2"}
  - `demo_sentence_audio_url`: NULL

- **B 级**:
  - `feedback_text`: 诊断 + 示范引导
  - `problem_words`: ["apple"]
  - `problem_word_audio_urls`: {"apple": "url1"}
  - `demo_sentence_audio_url`: NULL

- **C 级**:
  - `feedback_text`: 完整示范引导
  - `problem_words`: 可选
  - `problem_word_audio_urls`: NULL
  - `demo_sentence_audio_url`: "url_full_sentence"

---

### 表 6：learning_reports（学习报告表）

**用途**: 存储用户的学习报告数据，支持雷达图分析

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 报告 ID (UUID) |
| user_id | VARCHAR | 36 | ✓ | ✗ | - | 用户 ID (FK → users.id) |
| report_type | ENUM | - | ✓ | ✗ | 'weekly' | 报告类型：weekly / monthly / custom |
| period_start_date | DATE | - | ✓ | ✗ | - | 周期起始日期 |
| period_end_date | DATE | - | ✓ | ✗ | - | 周期结束日期 |
| total_conversations | INT | - | ✓ | ✗ | 0 | 总对话数 |
| total_evaluations | INT | - | ✓ | ✗ | 0 | 总评测数 |
| total_study_minutes | INT | - | ✓ | ✗ | 0 | 总学习时长（分钟） |
| average_conversation_score | FLOAT | - | ✓ | ✗ | 0.0 | 平均对话评分 |
| average_evaluation_score | FLOAT | - | ✓ | ✗ | 0.0 | 平均评测分数 |
| average_accuracy_score | FLOAT | - | ✓ | ✗ | 0.0 | **平均准确度评分**（用于雷达图） |
| average_fluency_score | FLOAT | - | ✓ | ✗ | 0.0 | **平均流利度评分**（用于雷达图） |
| average_integrity_score | FLOAT | - | ✓ | ✗ | 0.0 | **平均完整度评分**（用于雷达图） |
| s_level_count | INT | - | ✓ | ✗ | 0 | S 级评测数 |
| a_level_count | INT | - | ✓ | ✗ | 0 | A 级评测数 |
| b_level_count | INT | - | ✓ | ✗ | 0 | B 级评测数 |
| c_level_count | INT | - | ✓ | ✗ | 0 | C 级评测数 |
| improvement_rate | FLOAT | - | ✓ | ✗ | 0.0 | 进步率（与上期对比，百分比） |
| most_practiced_topics | JSON | - | ✗ | ✗ | NULL | 最常练习的主题（数组: ["Greetings", "Daily Routine"]） |
| problem_words | JSON | - | ✗ | ✗ | NULL | 高频问题单词（数组: ["apple", "orange", "beautiful"]） |
| strengths | JSON | - | ✗ | ✗ | NULL | 优势分析（数组: ["流利度提升明显", "完整度优秀"]） |
| weaknesses | JSON | - | ✗ | ✗ | NULL | 不足分析（数组: ["准确度需加强", "部分单词发音不清晰"]） |
| recommendations | LONGTEXT | - | ✗ | ✗ | NULL | AI 生成的学习建议 |
| ai_model | VARCHAR | 100 | ✗ | ✗ | NULL | 生成学习建议使用的 AI 模型 |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- FOREIGN KEY: `user_id` → `users(id)` ON DELETE CASCADE
- INDEX: `user_id`, `created_at`
- INDEX: `report_type`, `period_start_date`

**雷达图数据说明**:
- **维度**:
  1. 准确度（Accuracy）: `average_accuracy_score`
  2. 流利度（Fluency）: `average_fluency_score`
  3. 完整度（Integrity）: `average_integrity_score`

---

### 表 7：system_settings（系统配置表）

**用途**: 存储系统级配置参数

| 字段名 | 数据类型 | 长度 | 非空 | 唯一 | 默认值 | 说明 |
|--------|---------|------|------|------|--------|------|
| id | VARCHAR | 36 | ✓ | ✓ | - | 主键 ID (UUID) |
| config_key | VARCHAR | 100 | ✓ | ✓ | - | 配置键（唯一标识） |
| config_value | LONGTEXT | - | ✓ | ✗ | - | 配置值 |
| config_type | ENUM | - | ✓ | ✗ | 'string' | 配置类型：string / int / float / json / boolean |
| description | VARCHAR | 500 | ✗ | ✗ | NULL | 配置描述 |
| is_editable | BOOLEAN | - | ✓ | ✗ | TRUE | 是否可编辑 |
| created_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | - | ✓ | ✗ | CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- PRIMARY KEY: `id`
- UNIQUE KEY: `config_key`
- INDEX: `config_key`

**预设配置项**（系统初始化时插入）:

| 配置键 | 配置值 | 类型 | 说明 |
|--------|--------|------|------|
| `feedback_s_level_min_score` | `90` | int | S 级反馈最低分数 |
| `feedback_a_level_min_score` | `70` | int | A 级反馈最低分数 |
| `feedback_b_level_min_score` | `50` | int | B 级反馈最低分数 |
| `feedback_c_level_min_score` | `0` | int | C 级反馈最低分数 |
| `forbidden_words` | `["bad","wrong","terrible","fail","mistake","error","poor","awful"]` | json | 禁用词列表（反馈生成时过滤） |
| `report_generation_schedule` | `0 0 * * 1` | string | 报告生成时间表（Cron 表达式，每周一） |
| `max_audio_duration_seconds` | `60` | int | 最大录音时长（秒） |
| `max_conversation_messages` | `50` | int | 单次对话最大消息数 |
| `default_tts_voice` | `longanyang` | string | 默认 TTS 音色 |
| `default_llm_model` | `qwen-plus` | string | 默认 LLM 模型 |

---

## 第三部分：数据库关系图

```
users (用户基础信息)
  ↓ 1:1
user_profiles (用户扩展信息)
  ↓ 1:N
  ├── voice_conversations (对话记录)
  │     ↓ 1:N
  │     └── conversation_messages (消息明细)
  │
  ├── pronunciation_evaluations (评测记录)
  │
  └── learning_reports (学习报告)

system_settings (系统配置，独立表)
```

---

## 第四部分：关键设计说明

### 1. 分级反馈机制设计

**核心思想**: 根据评分动态调整反馈内容和示范音频

| 级别 | 评分范围 | 反馈策略 | 字段使用 |
|------|---------|---------|---------|
| **S 级** | 90-100 | 纯鼓励，不提供示范 | `feedback_text` |
| **A 级** | 70-89 | 鼓励 + 诊断，提供问题单词音频 | `feedback_text` + `problem_words` + `problem_word_audio_urls` |
| **B 级** | 50-69 | 诊断 + 示范，提供问题单词音频 | `feedback_text` + `problem_words` + `problem_word_audio_urls` |
| **C 级** | 0-49 | 完整示范，提供整句音频 | `feedback_text` + `demo_sentence_audio_url` |

**实现流程**:
```
评测完成 → 计算分数 → 确定级别 
  ↓
S 级: LLM 生成鼓励文本 → 生成反馈音频 → 完成
  ↓
A/B 级: LLM 生成诊断文本 → 提取问题单词 → TTS 生成单词音频 → 完成
  ↓
C 级: LLM 生成引导文本 → TTS 生成整句音频 → 完成
```

---

### 2. 学习报告雷达图设计

**三维分析**:
1. **准确度**（Accuracy）: 发音是否准确
2. **流利度**（Fluency）: 语速是否自然
3. **完整度**（Integrity）: 是否完整朗读

**数据来源**:
- `pronunciation_evaluations` 表中的 `accuracy_score`, `fluency_score`, `integrity_score`
- 按时间范围聚合平均值

**前端展示**:
```javascript
// ECharts 雷达图配置
{
  radar: {
    indicator: [
      { name: 'Accuracy', max: 100 },
      { name: 'Fluency', max: 100 },
      { name: 'Integrity', max: 100 }
    ]
  },
  series: [{
    type: 'radar',
    data: [{
      value: [80, 75, 85],  // [准确度, 流利度, 完整度]
      name: '本周表现'
    }]
  }]
}
```

---

### 3. 消息存储重构说明

**原设计问题**:
- 一条记录同时存储用户消息和 AI 回复
- 字段冗余，查询复杂

**新设计优势**:
- 每条消息（用户或 AI）单独一条记录
- 结构清晰，易于查询和分页
- 支持多轮对话的顺序展示

**存储示例**:
```sql
-- 对话 conv_001
INSERT INTO conversation_messages VALUES
('msg_001', 'conv_001', 'user', 'Hello', 'audio1.wav', 2, 1, ...),
('msg_002', 'conv_001', 'ai',   'Hi! How are you?', 'audio2.mp3', 3, 2, ...),
('msg_003', 'conv_001', 'user', 'I am fine', 'audio3.wav', 3, 3, ...),
('msg_004', 'conv_001', 'ai',   'Great!', 'audio4.mp3', 2, 4, ...);
```

---

### 4. JSON 字段使用说明

**为什么使用 JSON**:
- 存储复杂的嵌套数据（趋势、列表）
- 避免创建额外的关联表
- 灵活性强，易于扩展

**使用场景**:
- `problem_words`: `["apple", "orange"]`
- `problem_word_audio_urls`: `{"apple": "url1", "orange": "url2"}`
- `accuracy_trend`: `[65, 70, 75, 80]`
- `most_practiced_topics`: `["Greetings", "Food"]`

**Go 中的处理**:
```go
// GORM 自动处理 JSON 字段
type Evaluation struct {
    ProblemWords      []string          `gorm:"type:json" json:"problem_words"`
    ProblemWordAudios map[string]string `gorm:"type:json" json:"problem_word_audio_urls"`
}
```

---

## 第五部分：数据量估算与性能优化

### 数据量估算

假设系统有 **1,000 个活跃用户**，每人每周：
- 进行 10 次对话，每次对话 20 条消息
- 进行 20 次发音评测
- 生成 1 份学习报告

**预估数据量**（年）:

| 表名 | 年增长量 | 累计量 |
|------|---------|-------|
| users | 1K | 1K |
| voice_conversations | 520K | 520K |
| conversation_messages | 10.4M | 10.4M |
| pronunciation_evaluations | 1.04M | 1.04M |
| learning_reports | 52K | 52K |

---

### 性能优化策略

1. **索引优化**
   - 为高频查询字段建立索引（`user_id`, `created_at`, `status`）
   - 复合索引：`(user_id, created_at)` 加速用户历史查询

2. **冗余字段**
   - `user_profiles` 中维护统计数据，避免频繁聚合

3. **分页查询**
   - 使用 `LIMIT` + `OFFSET` 或游标分页
   - 避免一次性加载大量消息

4. **JSON 字段索引**
   - MySQL 8.0+ 支持 JSON 字段索引
   - 如需频繁查询 JSON 内容，考虑提取为独立字段

5. **读写分离**
   - 报告生成等读密集操作使用从库
   - 评测提交等写操作使用主库

---

## 第六部分：总结

### 设计特点

1. **精简高效**: 7 张表完整支持 PRD 的 3 个核心功能
2. **分级反馈**: 根据评分提供不同级别的反馈和示范音频
3. **雷达图分析**: 三维评分系统（准确度、流利度、完整度）
4. **消息重构**: 清晰的消息存储结构，易于查询和展示
5. **扩展性强**: JSON 字段支持灵活的数据存储

### 与 PRD 功能映射

| PRD 功能 | 涉及表 | 关键字段 |
|---------|-------|---------|
| **功能 1: AI 语音对话** | `voice_conversations`, `conversation_messages` | `conversation_type`, `sender_type` |
| **功能 2: AI 发音纠正** | `pronunciation_evaluations` | `feedback_level`, `problem_words`, `demo_sentence_audio_url` |
| **功能 3: 智能学习报告** | `learning_reports` | `average_accuracy_score`, `fluency_trend`, `accuracy_trend` |

---

## 附录：版本更新日志

**v2.0 (2026-02-15) - 最终确定版**
- ✅ 删除 `feedback_records` 表（功能重复）
- ✅ 删除 `evaluation_details` 表（简化设计）
- ✅ 删除 `report_statistics` 表（直接聚合）
- ✅ 重构 `conversation_messages` 表（消息分离存储）
- ✅ 补充 `pronunciation_evaluations` 表字段（支持分级反馈）
- ✅ 补充 `learning_reports` 表字段（支持雷达图）
- ✅ 明确 7 张表的最终设计

**v1.0 (2026-01-22) - 初始版本**
- 10 张表的初始设计

---
